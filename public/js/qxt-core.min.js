var QXT=QXT||{};QXT.local={nothing_selected:"Nothing selected",nothing_found:"Nothing found",choose_file:"Choose file",file_selected:"File selected",files_selected:"Files selected",add_more_files:"Add more files",adding_more_files:"Adding more files",drop_files_here_paste_or:"Drop files here, paste or",browse:"Browse",upload_complete:"Upload complete",upload_paused:"Upload paused",resume_upload:"Resume upload",pause_upload:"Pause upload",retry_upload:"Retry upload",cancel_upload:"Cancel upload",uploading:"Uploading",processing:"Processing",complete:"Complete",file:"File",files:"Files"},$.fn.toggleAttr=function(e,l,a){return this.each(function(){var t=$(this);t.attr(e)==l?t.attr(e,a):t.attr(e,l)})},function(e){"use strict";QXT.data={csrf:e('meta[name="csrf-token"]').attr("content"),appUrl:e('meta[name="app-url"]').attr("content"),fileBaseUrl:e('meta[name="file-base-url"]').attr("content")},QXT.uploader={data:{selectedFiles:[],selectedFilesObject:[],clickedForDelete:null,allFiles:[],multiple:!1,type:"all",next_page_url:null,prev_page_url:null},removeInputValue:function(l,a,t){var d=a.filter(function(e){return e!==l});d.length>0?e(t).find(".file-amount").html(QXT.uploader.updateFileHtml(d)):t.find(".file-amount").html("Choose File"),e(t).find(".selected-files").val(d)},removeAttachment:function(){e(document).on("click",".remove-attachment",function(){var l=e(this).closest(".file-preview-item").data("id"),a=e(this).closest(".file-preview").prev('[data-toggle="qxtuploader"]').find(".selected-files").val().split(",").map(Number);QXT.uploader.removeInputValue(l,a,e(this).closest(".file-preview").prev('[data-toggle="qxtuploader"]')),e(this).closest(".file-preview-item").remove()})},deleteUploaderFile:function(){e(".qxt-uploader-delete").each(function(){e(this).on("click",function(l){l.preventDefault();var a=e(this).data("id");QXT.uploader.data.clickedForDelete=a,e("#qxtUploaderDelete").modal("show"),e(".qxt-uploader-confirmed-delete").on("click",function(l){if(l.preventDefault(),1===l.detail){var a=QXT.uploader.data.allFiles[QXT.uploader.data.allFiles.findIndex(e=>e.id===QXT.uploader.data.clickedForDelete)];e.ajax({url:QXT.data.appUrl+"/qxt-uploader/destroy/"+QXT.uploader.data.clickedForDelete,type:"DELETE",dataType:"JSON",data:{id:QXT.uploader.data.clickedForDelete,_method:"DELETE",_token:QXT.data.csrf},success:function(){QXT.uploader.data.selectedFiles=QXT.uploader.data.selectedFiles.filter(function(e){return e!==QXT.uploader.data.clickedForDelete}),QXT.uploader.data.selectedFilesObject=QXT.uploader.data.selectedFilesObject.filter(function(e){return e!==a}),QXT.uploader.updateUploaderSelected(),QXT.uploader.getAllUploads(QXT.data.appUrl+"/qxt-uploader/get_uploaded_files"),QXT.uploader.data.clickedForDelete=null,e("#qxtUploaderDelete").modal("hide")}})}})})})},uploadSelect:function(){e(".qxt-uploader-select").each(function(){var l=e(this);l.on("click",function(a){var t=e(this).data("value"),d=QXT.uploader.data.allFiles[QXT.uploader.data.allFiles.findIndex(e=>e.id===t)];l.closest(".qxt-file-box-wrap").toggleAttr("data-selected","true","false"),QXT.uploader.data.multiple||l.closest(".qxt-file-box-wrap").siblings().attr("data-selected","false"),QXT.uploader.data.selectedFiles.includes(t)?(QXT.uploader.data.selectedFiles=QXT.uploader.data.selectedFiles.filter(function(e){return e!==t}),QXT.uploader.data.selectedFilesObject=QXT.uploader.data.selectedFilesObject.filter(function(e){return e!==d})):(QXT.uploader.data.multiple||(QXT.uploader.data.selectedFiles=[],QXT.uploader.data.selectedFilesObject=[]),QXT.uploader.data.selectedFiles.push(t),QXT.uploader.data.selectedFilesObject.push(d)),QXT.uploader.addSelectedValue(),QXT.uploader.updateUploaderSelected()})})},updateFileHtml:function(e){return e.length,e.length+" File selected"},updateUploaderSelected:function(){e(".qxt-uploader-selected").html(QXT.uploader.updateFileHtml(QXT.uploader.data.selectedFiles))},clearUploaderSelected:function(){e(".qxt-uploader-selected-clear").on("click",function(){QXT.uploader.data.selectedFiles=[],QXT.uploader.addSelectedValue(),QXT.uploader.addHiddenValue(),QXT.uploader.resetFilter(),QXT.uploader.updateUploaderSelected(),QXT.uploader.getAllUploads(images_uploaded_files)})},resetFilter:function(){e('[name="qxt-uploader-search"]').val(""),e('[name="qxt-uploader-sort"] option[value=newest]').prop("selected",!0)},getAllUploads:function(l,a=null,t=null){e(".qxt-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100"><div class="spinner-border" role="status"></div></div>');var d={};null!=a&&a.length>0&&(d.search=a,setTimeout(()=>{e('[name="qxt-uploader-search"]').val(a)},600)),null!=t&&t.length>0?(d.sort=t,setTimeout(()=>{e('[name="qxt-uploader-sort"]').val(t)},600)):d.sort="newest",e.get(l,d,function(l,a){"string"==typeof l&&(l=JSON.parse(l)),QXT.uploader.data.allFiles=l.data,QXT.uploader.allowedFileType(),QXT.uploader.addSelectedValue(),QXT.uploader.addHiddenValue(),QXT.uploader.resetFilter(),QXT.uploader.updateUploaderFiles(l.data),null!=l.next_page_url?(QXT.uploader.data.next_page_url=l.next_page_url,e("#uploader_next_btn").removeAttr("disabled")):e("#uploader_next_btn").attr("disabled",!0),null!=l.prev_page_url?(QXT.uploader.data.prev_page_url=l.prev_page_url,e("#uploader_prev_btn").removeAttr("disabled")):e("#uploader_prev_btn").attr("disabled",!0)})},showSelectedFiles:function(){e('[name="qxt-show-selected"]').on("change",function(){e(this).is(":checked")?QXT.uploader.data.allFiles=QXT.uploader.data.selectedFiles:QXT.uploader.getAllUploads(images_uploaded_files),QXT.uploader.updateUploaderFiles()})},searchUploaderFiles:function(){e('[name="qxt-uploader-search"]').on("keyup",function(){var l=e(this).val();QXT.uploader.getAllUploads(images_uploaded_files,l,e('[name="qxt-uploader-sort"]').val())})},sortUploaderFiles:function(){e('[name="qxt-uploader-sort"]').on("change",function(){var l=e(this).val();QXT.uploader.getAllUploads(images_uploaded_files,e('[name="qxt-uploader-search"]').val(),l)})},addSelectedValue:function(){for(var e=0;e<QXT.uploader.data.allFiles.length;e++)QXT.uploader.data.selectedFiles.includes(QXT.uploader.data.allFiles[e].id)?QXT.uploader.data.allFiles[e].selected=!0:QXT.uploader.data.allFiles[e].selected=!1},addHiddenValue:function(){for(var e=0;e<QXT.uploader.data.allFiles.length;e++)QXT.uploader.data.allFiles[e].aria_hidden=!1},allowedFileType:function(){"all"!==QXT.uploader.data.type&&(QXT.uploader.data.allFiles=QXT.uploader.data.allFiles.filter(function(e){return e.type===QXT.uploader.data.type}))},updateUploaderFiles:function(l){e(".qxt-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100"><div class="spinner-border" role="status"></div></div>'),setTimeout(function(){if(e(".qxt-uploader-all").html(null),l.length>0)for(var a=0;a<l.length;a++){var t="";t="img"===l[a].collection_name?'<img src="'+QXT.data.fileBaseUrl+"/media/"+l[a].id+"/"+l[a].file_name+'" class="img-fit 2">':'<i class="fa fa-file-text"></i>';var d='<div class="qxt-file-box-wrap col-auto w-200px w-lg-220px" aria-hidden="false" data-selected="'+(-1!==jQuery.inArray(l[a].id,QXT.uploader.data.selectedFiles)?"true":"false")+'"><div class="qxt-file-box"><div class="card card-file qxt-uploader-select" title="'+l[a].file_name+'" data-value="'+l[a].id+'"><div class="card-file-thumb">'+t+'</div><div class="card-body"><h6 class="d-flex mb-0"><span class="text-truncate title">'+l[a].file_name+'</span><span class="ext"></span></h6><p>'+QXT.extra.bytesToSize(l[a].size)+"</p></div></div></div></div>";e(".qxt-uploader-all").append(d)}else e(".qxt-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100 nav-tabs"><div class="text-center"><h3>No files found</h3></div></div>');QXT.uploader.uploadSelect(),QXT.uploader.deleteUploaderFile()},500)},inputSelectPreviewGenerate:function(l){l.find(".selected-files").val(QXT.uploader.data.selectedFiles),l.next(".file-preview").html(null),QXT.uploader.data.selectedFiles.length>0?e.post(images_uploaded_files,{_token:QXT.data.csrf,ids:QXT.uploader.data.selectedFiles.toString()},function(e){if(e=e.data,l.next(".file-preview").html(null),e.length>0){l.find(".file-amount").html(QXT.uploader.updateFileHtml(e));for(var a=0;a<e.length;a++){var t="";t="img"===e[a].collection_name?'<img src="'+QXT.data.fileBaseUrl+"/media/"+e[a].id+"/"+e[a].file_name+'" class="img-fit 3">':'<i class="fa fa-file-text"></i>';var d='<div class="d-flex justify-content-between align-items-center mt-2 file-preview-item" data-id="'+e[a].id+'" title="'+e[a].file_name+'"><div class="align-items-center align-self-stretch d-flex justify-content-center thumb">'+t+'</div><div class="col body"><h6 class="d-flex"><span class="text-truncate title">'+e[a].file_name+"</span></h6><p>"+QXT.extra.bytesToSize(e[a].size)+'</p></div><div class="remove"><button class="btn btn-sm btn-link text-danger remove-attachment" type="button"><i class="fa fa-close"></i></button></div></div>';l.next(".file-preview").append(d)}}else l.find(".file-amount").html("Choose File")}):l.find(".file-amount").html("Choose File")},editorImageGenerate:function(e){if(QXT.uploader.data.selectedFiles.length>0)for(var l=0;l<QXT.uploader.data.selectedFiles.length;l++){var a=QXT.uploader.data.allFiles.findIndex(e=>e.id===QXT.uploader.data.selectedFiles[l]),t="";"image"===QXT.uploader.data.allFiles[a].type&&(t='<img src="'+QXT.data.fileBaseUrl+QXT.uploader.data.allFiles[a].file_name+'">',e[0].insertHTML(t))}},dismissUploader:function(){e("#qxtUploaderModal").on("hidden.bs.modal",function(){e(".qxt-uploader-backdrop").remove(),e("#qxtUploaderModal").remove()})},trigger:function(l=null,a="",t="all",d="",i=!1,o=null){var l=e(l),i=i,t=t,r=d;""!==r?QXT.uploader.data.selectedFiles=r.split(",").map(Number):QXT.uploader.data.selectedFiles=[],void 0!==t&&t.length>0&&(QXT.uploader.data.type=t),i&&(QXT.uploader.data.multiple=i),e.post(QXT.data.appUrl+"/store/images/view/uploaded-files",{_token:QXT.data.csrf},function(t){e("body").append(t),e("#qxtUploaderModal").modal("show"),e("#qxtUploaderModal").find(".dropzone").dropzone({paramName:"image",uploadMultiple:!0,acceptedFiles:".jpeg,.jpg,.png,.gif,.JPG,.JPEG,.PNG",parallelUploads:100,dictCancelUpload:"Cancel",init:function(){this.on("success",function(e,l){toastr.success(l.success,"Success!",{closeButton:!0,tapToDismiss:!1}),QXT.uploader.getAllUploads(images_uploaded_files)})}}),QXT.uploader.getAllUploads(images_uploaded_files,null,e('[name="qxt-uploader-sort"]').val()),QXT.uploader.updateUploaderSelected(),QXT.uploader.clearUploaderSelected(),QXT.uploader.sortUploaderFiles(),QXT.uploader.searchUploaderFiles(),QXT.uploader.showSelectedFiles(),QXT.uploader.dismissUploader(),e("#uploader_next_btn").on("click",function(){null!=QXT.uploader.data.next_page_url&&(e('[name="qxt-show-selected"]').prop("checked",!1),QXT.uploader.getAllUploads(QXT.uploader.data.next_page_url))}),e("#uploader_prev_btn").on("click",function(){null!=QXT.uploader.data.prev_page_url&&(e('[name="qxt-show-selected"]').prop("checked",!1),QXT.uploader.getAllUploads(QXT.uploader.data.prev_page_url))}),e(".qxt-uploader-search i").on("click",function(){e(this).parent().toggleClass("open")}),e('[data-toggle="qxtUploaderAddSelected"]').on("click",function(){"input"===a?QXT.uploader.inputSelectPreviewGenerate(l):"direct"===a&&o(QXT.uploader.data.selectedFiles),e("#qxtUploaderModal").modal("hide")})})},initForInput:function(){e(document).on("click",'[data-toggle="qxtuploader"]',function(l){if(1===l.detail){var a=e(this),t=a.data("multiple"),d=a.data("type"),i=a.find(".selected-files").val();t=t||"",d=d||"",i=i||"",QXT.uploader.trigger(this,"input",d,i,t)}})},previewGenerate:function(){e('[data-toggle="qxtuploader"]').each(function(){var l=e(this),a=l.find(".selected-files").val();""!=a&&e.post(images_uploaded_files,{_token:QXT.data.csrf,ids:a},function(e){if(l.next(".file-preview").html(null),(e=e.data).length>0){l.find(".file-amount").html(QXT.uploader.updateFileHtml(e));for(var a=0;a<e.length;a++){var t="";t="img"===e[a].collection_name?'<img src="'+QXT.data.fileBaseUrl+"/media/"+e[a].id+"/"+e[a].file_name+'" class="img-fit 1">':'<i class="fa fa-file-text"></i>';var d='<div class="d-flex justify-content-between align-items-center mt-2 file-preview-item" data-id="'+e[a].id+'" title="'+e[a].file_name+'"><div class="align-items-center align-self-stretch d-flex justify-content-center thumb">'+t+'</div><div class="col body"><h6 class="d-flex"><span class="text-truncate title">'+e[a].file_name+"</span></h6><p>"+QXT.extra.bytesToSize(e[a].size)+'</p></div><div class="remove"><button class="btn btn-sm btn-link text-danger remove-attachment" type="button"><i class="fa fa-close"></i></button></div></div>';l.next(".file-preview").append(d)}}else l.find(".file-amount").html("Choose File")})})}},QXT.plugins={qxtUppy:function(){if(e("#qxt-upload-files").length>0){var l=Uppy.Core({autoProceed:!0});l.use(Uppy.Dashboard,{target:"#qxt-upload-files",inline:!0,showLinkToFileUploadResult:!1,showProgressDetails:!0,hideCancelButton:!0,hidePauseResumeButton:!0,hideUploadButton:!0,proudlyDisplayPoweredByUppy:!1}),l.use(Uppy.XHRUpload,{endpoint:QXT.data.appUrl+"/qxt-uploader/upload",fieldName:"qxt_file",formData:!0,headers:{"X-CSRF-TOKEN":QXT.data.csrf}}),l.on("upload-success",function(){QXT.uploader.getAllUploads(QXT.data.appUrl+"/qxt-uploader/get_uploaded_files")})}}},QXT.extra={bytesToSize:function(e){if(0==e)return"0 Byte";var l=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,l),2)+" "+["Bytes","KB","MB","GB","TB"][l]}},QXT.uploader.initForInput(),QXT.uploader.removeAttachment(),QXT.uploader.previewGenerate()}(jQuery);